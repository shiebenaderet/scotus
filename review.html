<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review | SCOTUS Debate Project</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/case.css">
    <style>
        /* REVIEW PAGE SPECIFIC STYLES */
        .review-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* NAVIGATION BUTTONS */
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .nav-btn {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(26, 26, 46, 0.25);
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(26, 26, 46, 0.35);
        }

        .nav-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(26, 26, 46, 0.2);
        }

        .nav-btn.secondary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
            box-shadow: 0 3px 10px rgba(214, 56, 80, 0.3);
        }

        .nav-btn.secondary:hover {
            box-shadow: 0 8px 24px rgba(214, 56, 80, 0.4);
        }

        .nav-btn.success {
            background: linear-gradient(135deg, #4facfe 0%, #00c6fb 100%);
            box-shadow: 0 3px 10px rgba(79, 172, 254, 0.3);
        }

        .nav-btn.success:hover {
            box-shadow: 0 8px 24px rgba(79, 172, 254, 0.4);
        }

        /* SECTIONS */
        .section { display: none; }
        .section.active { display: block; }

        /* PROGRESS BAR */
        .progress-bar {
            background: var(--bg-warm);
            border: 1px solid var(--border);
            height: 30px;
            border-radius: 15px;
            overflow: visible;
            margin: 20px 0;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-hover) 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 15px;
            box-shadow: 0 1px 4px rgba(214, 56, 80, 0.3);
        }

        .progress-bar .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            z-index: 1;
        }

        /* STATS GRID */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(26, 26, 46, 0.2);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(26, 26, 46, 0.3);
        }

        .stat-card .number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-weight: 700;
            font-size: 0.95em;
        }

        /* QUESTION CARD */
        .question-card {
            background: var(--bg-white);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid var(--accent);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        }

        .question-card h3 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .question-card .question-topic {
            display: inline-block;
            background: #fce7ea;
            color: var(--accent);
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* MULTIPLE CHOICE OPTIONS */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .option {
            padding: 15px 20px;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-size: 1em;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        }

        .option:hover {
            border-color: var(--accent);
            background: #fef2f3;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }

        .option.selected {
            border-color: var(--accent);
            background: #fce7ea;
            box-shadow: 0 2px 8px rgba(214, 56, 80, 0.15);
        }

        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }

        .option.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
        }

        /* FEEDBACK */
        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .feedback.show { display: block; }

        .feedback.correct {
            background: #d1fae5;
            border-left: 5px solid #10b981;
        }

        .feedback.incorrect {
            background: #fee2e2;
            border-left: 5px solid #ef4444;
        }

        .feedback h4 { margin-bottom: 10px; }

        /* SHORT ANSWER */
        .short-answer-area {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            margin: 15px 0;
        }

        .short-answer-area:focus {
            outline: none;
            border-color: var(--primary-dark);
        }

        .sa-part-label {
            display: inline-block;
            color: #fff;
            font-weight: 700;
            font-size: 0.75em;
            letter-spacing: 0.08em;
            padding: 3px 10px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .sa-starters-list {
            margin-bottom: 10px;
        }

        .sa-starter-option {
            display: block;
            font-size: 0.9em;
            color: var(--primary-dark);
            background: #f0f4ff;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            margin: 4px 0;
            cursor: pointer;
            transition: background 0.15s, border-color 0.15s;
        }

        .sa-starter-option:hover {
            background: #e0e7ff;
            border-color: var(--primary-dark);
        }

        .btn-success {
            background: #10b981;
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-success:hover {
            background: #059669;
        }

        .sa-part-card {
            transition: border-left-color 0.2s;
        }

        .exemplar {
            background: #f0f4ff;
            border-left: 4px solid var(--primary-dark);
            padding: 15px 20px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
            display: none;
        }

        .exemplar.show { display: block; }

        .exemplar h4 {
            color: var(--primary-dark);
            margin-bottom: 8px;
        }

        .rubric-checklist {
            margin: 15px 0;
            display: none;
        }

        .rubric-checklist.show { display: block; }

        .rubric-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }

        .rubric-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* AMENDMENTS ACTIVITY */
        .amend-level-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .amend-level-tab {
            flex: 1;
            padding: 14px 20px;
            border: 3px solid var(--border);
            border-radius: 12px;
            background: var(--bg-white);
            cursor: pointer;
            text-align: center;
            transition: all 0.25s;
            font-weight: 600;
            font-size: 0.95em;
        }

        .amend-level-tab:hover:not(.locked) {
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .amend-level-tab.active {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            border-color: var(--primary-dark);
        }

        .amend-level-tab.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .amend-level-tab .tab-subtitle {
            font-size: 0.8em;
            font-weight: 400;
            opacity: 0.8;
            margin-top: 3px;
        }

        /* Level 1: Click-to-Assign — stacked layout */
        .match-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px 0;
        }

        /* Amendments panel: compact sticky strip at top */
        .match-amendments-panel {
            background: var(--bg-warm);
            padding: 16px 20px;
            border-radius: 15px;
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.06);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .match-amendments-panel h3 {
            margin-bottom: 10px;
            font-size: 1em;
            color: var(--primary-dark);
        }

        .amend-group-label {
            font-size: 0.78em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: #888;
            font-weight: 700;
            margin: 10px 0 6px;
        }

        .amend-group-label:first-child { margin-top: 0; }

        #match-amendments-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .amend-btn {
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 6px 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            position: relative;
            flex: 0 0 auto;
        }

        .amend-btn:hover:not(.has-item) {
            border-color: var(--primary-dark);
            background: #e0e7ff;
        }

        .amend-btn.waiting {
            border-color: var(--accent);
            background: #fff0f2;
            animation: pulse-border 1.5s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { box-shadow: 0 0 0 0 rgba(214, 56, 80, 0.3); }
            50% { box-shadow: 0 0 0 6px rgba(214, 56, 80, 0); }
        }

        .amend-btn .amend-name {
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 0.85em;
            white-space: nowrap;
        }

        .amend-btn .amend-desc {
            display: none;
        }

        .amend-btn .amend-count {
            display: inline-block;
            background: var(--primary-dark);
            color: #fff;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            line-height: 18px;
            font-size: 0.72em;
            font-weight: 700;
            text-align: center;
            margin-left: 5px;
            vertical-align: middle;
        }

        .amend-btn .placed-items {
            display: none;
        }

        /* Expanded amendment (when it has items or on hover to show description) */
        .amend-btn.has-items {
            border-color: var(--primary-dark);
            background: #f0f4ff;
        }

        /* Tooltip showing description on hover */
        .amend-btn .amend-tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-dark);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8em;
            line-height: 1.4;
            white-space: normal;
            width: 240px;
            text-align: left;
            z-index: 20;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            pointer-events: none;
        }

        .amend-btn .amend-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: var(--primary-dark);
        }

        .amend-btn:hover .amend-tooltip {
            display: block;
        }

        /* Drawer for viewing placed items */
        .amend-drawer {
            display: none;
            background: var(--bg-warm);
            border: 2px solid var(--primary-dark);
            border-radius: 10px;
            padding: 12px 16px;
            margin-top: 8px;
        }

        .amend-drawer.open {
            display: block;
        }

        .amend-drawer-title {
            font-weight: 700;
            font-size: 0.9em;
            color: var(--primary-dark);
            margin-bottom: 4px;
        }

        .amend-drawer-desc {
            font-size: 0.82em;
            color: #666;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .amend-drawer .placed-items-drawer {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .amend-drawer .placed-tag {
            background: #f0f4ff;
            border: 2px solid var(--primary-dark);
            border-radius: 6px;
            padding: 5px 10px;
            font-size: 0.85em;
            color: var(--primary-dark);
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .amend-drawer .placed-tag .remove-x {
            cursor: pointer;
            font-weight: 700;
            margin-left: 8px;
            color: #999;
            font-size: 1.1em;
        }

        .amend-drawer .placed-tag .remove-x:hover { color: #ef4444; }

        .amend-drawer .placed-tag.correct-tag {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .amend-drawer .placed-tag.incorrect-tag {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        /* Rights panel below */
        .match-items-panel {
            background: var(--bg-warm);
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.06);
        }

        .match-items-panel h3 {
            margin-bottom: 12px;
            font-size: 1em;
            color: var(--primary-dark);
        }

        #match-items-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .match-item {
            background: var(--bg-white);
            border: 3px solid var(--border);
            border-radius: 10px;
            padding: 10px 14px;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            font-size: 0.92em;
            line-height: 1.4;
        }

        .match-item:hover:not(.placed) {
            border-color: var(--primary-dark);
            box-shadow: 0 3px 10px rgba(0,0,0,0.12);
            transform: translateY(-1px);
        }

        .match-item.selected {
            border-color: var(--accent);
            background: #fff0f2;
            box-shadow: 0 0 0 2px rgba(214, 56, 80, 0.2);
        }

        .match-item.placed {
            opacity: 0.45;
            cursor: default;
            text-decoration: line-through;
        }

        .match-item.correct {
            border-color: #10b981;
            background: #d1fae5;
            opacity: 1;
            text-decoration: none;
        }

        .match-item.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
            opacity: 1;
            text-decoration: none;
        }

        /* Level 2: Apply It */
        .case-challenge {
            background: var(--bg-white);
            border: 3px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .case-challenge .case-label {
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .case-challenge .case-name {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 10px;
        }

        .case-challenge .case-desc {
            font-size: 0.95em;
            line-height: 1.6;
            color: #444;
            margin-bottom: 18px;
        }

        .case-challenge .amend-choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .case-challenge .amend-choice {
            padding: 12px 16px;
            border: 3px solid var(--border);
            border-radius: 10px;
            background: var(--bg-white);
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            font-size: 0.92em;
            text-align: center;
        }

        .case-challenge .amend-choice:hover:not(.chosen) {
            border-color: var(--primary-dark);
            background: #e0e7ff;
            transform: translateY(-1px);
        }

        .case-challenge .amend-choice.chosen {
            border-color: var(--primary-dark);
            background: var(--primary-dark);
            color: var(--text-light);
        }

        .case-challenge .amend-choice.correct-choice {
            border-color: #10b981;
            background: #d1fae5;
            color: #065f46;
        }

        .case-challenge .amend-choice.incorrect-choice {
            border-color: #ef4444;
            background: #fee2e2;
            color: #991b1b;
        }

        .case-challenge .case-feedback {
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.9em;
            line-height: 1.5;
            display: none;
        }

        .case-challenge .case-feedback.show { display: block; }

        .case-challenge .case-feedback.correct-fb {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
        }

        .case-challenge .case-feedback.incorrect-fb {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
        }

        .case-challenge .oyez-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 0.88em;
            color: var(--primary-dark);
            font-weight: 600;
            text-decoration: underline;
        }

        .case-challenge .oyez-link:hover { color: var(--accent); }

        .level-progress {
            background: var(--bg-warm);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .level-progress .progress-bar-outer {
            flex: 1;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .level-progress .progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #e85d75);
            border-radius: 6px;
            transition: width 0.4s ease;
        }

        .level-progress .progress-text {
            font-weight: 700;
            font-size: 0.95em;
            white-space: nowrap;
            color: var(--primary-dark);
        }

        /* BUTTONS */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.25s ease;
            margin: 5px;
        }

        .btn-primary {
            background: var(--accent);
            color: var(--text-light);
            box-shadow: 0 2px 8px rgba(214, 56, 80, 0.25);
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(214, 56, 80, 0.35);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(214, 56, 80, 0.25);
        }

        .btn-secondary {
            background: var(--bg-warm);
            color: var(--text-dark);
            border: 1px solid var(--border);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
        }

        .btn-secondary:hover {
            background: #eae7e1;
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .btn-danger:hover {
            background: #fecaca;
            transform: translateY(-1px);
        }

        /* ALERTS */
        .review-content .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.06);
        }

        .review-content .alert.info {
            background: var(--bg-warm);
            border-left: 5px solid var(--primary-dark);
            color: var(--text-dark);
        }

        .review-content .alert.success {
            background: #d1fae5;
            border-left: 5px solid #10b981;
            color: #065f46;
        }

        /* FLASHCARDS */
        .flashcard {
            perspective: 1000px;
            width: 100%;
            max-width: 600px;
            height: 280px;
            margin: 30px auto;
            cursor: pointer;
        }

        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }

        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            text-align: center;
        }

        .flashcard-front {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            border: 3px solid var(--primary-light);
            box-shadow: 0 6px 20px rgba(26, 26, 46, 0.25);
        }

        .flashcard-front h3 {
            font-size: 1.6em;
            margin-bottom: 10px;
        }

        .flashcard-back {
            background: var(--bg-white);
            border: 3px solid var(--accent);
            transform: rotateY(180deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
        }

        .flashcard-back p {
            font-size: 1.15em;
            line-height: 1.6;
            color: var(--text-dark);
        }

        .flashcard-back .card-label {
            font-size: 0.8em;
            font-weight: 700;
            color: var(--primary-dark);
            background: #dbeafe;
            padding: 4px 12px;
            border-radius: 15px;
            margin-bottom: 15px;
        }

        .flashcard.known .flashcard-front {
            border-color: #10b981;
        }

        .flashcard.known .flashcard-front::after {
            content: 'Mastered';
            position: absolute;
            top: 12px;
            right: 12px;
            background: #10b981;
            color: white;
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: 600;
        }

        .card-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
        }

        .flip-indicator {
            text-align: center;
            color: #999;
            font-style: italic;
            font-size: 0.9em;
            margin: 10px 0;
        }

        .keyboard-hint {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin: 15px 0;
            font-size: 0.85em;
            color: #888;
        }

        .keyboard-hint .key {
            display: inline-block;
            background: #e0e0e0;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 2px 8px;
            font-family: monospace;
            font-size: 0.9em;
            min-width: 24px;
            text-align: center;
        }

        .reset-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 0.9em;
            text-decoration: underline;
            margin-top: 10px;
        }

        .reset-btn:hover {
            color: #dc2626;
        }

        /* SAVE/LOAD */
        .save-load-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
            text-align: center;
        }

        .save-load-section p {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            #match-items-list { grid-template-columns: 1fr; }
            .case-challenge .amend-choices { grid-template-columns: 1fr; }
            .flashcard { height: 240px; }
            .flashcard-front h3 { font-size: 1.3em; }
            .keyboard-hint { display: none; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .review-content { padding: 15px; }
            .nav-buttons { grid-template-columns: 1fr; }
            .flashcard { height: 220px; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .amend-level-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="site-header" role="banner">
        <div class="container header-inner">
            <a href="index.html" class="site-logo">
                <span class="logo-icon">⚖️</span>
                <span class="logo-text">SCOTUS Debate Project</span>
            </a>
            <nav class="header-nav" role="navigation" aria-label="Main navigation">
                <a href="index.html#cases">Cases</a>
                <a href="resources.html">Resources</a>
                <a href="index.html">Home</a>
            </nav>
        </div>
    </header>

    <main id="main-content" role="main">
        <section class="case-header">
            <div class="container">
                <h1>SCOTUS Review</h1>
            </div>
        </section>

        <div class="review-content">
            <!-- HOME / DASHBOARD -->
            <div id="home" class="section active">
                <h2>Review Dashboard</h2>
                <p style="margin: 10px 0 20px; color: #666;">Review what you've learned about Supreme Court cases and the Bill of Rights.</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="number" id="vocab-score">0/24</div>
                        <div class="label">Vocab Mastered</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="mc-score">0%</div>
                        <div class="label">Multiple Choice</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="sa-score">0/7</div>
                        <div class="label">Short Answer</div>
                    </div>
                    <div class="stat-card">
                        <div class="number" id="sort-score">0%</div>
                        <div class="label">Amendments</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="nav-btn" onclick="showSection('vocab')">Vocabulary</button>
                    <button class="nav-btn secondary" onclick="showSection('practice')">Multiple Choice</button>
                    <button class="nav-btn" onclick="showSection('shortanswer')">Short Answer</button>
                    <button class="nav-btn success" onclick="showSection('sort')">Amendments Challenge</button>
                </div>

                <div class="alert info">
                    <span>This review covers key concepts from the SCOTUS cases and the Bill of Rights. Complete each section to track your progress.</span>
                </div>

                <div class="save-load-section">
                    <p>Your progress is saved automatically in this browser. Use the buttons below to back up or transfer your progress.</p>
                    <button class="btn btn-primary" onclick="saveAllProgress()">Save Progress</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('load-file').click()">Load Progress</button>
                    <input type="file" id="load-file" accept=".json" style="display:none" onchange="loadAllProgress(event)">
                    <br>
                    <button class="reset-btn" onclick="resetAllProgress()">Reset All Progress</button>
                </div>
            </div>

            <!-- VOCABULARY FLASHCARDS -->
            <div id="vocab" class="section">
                <button class="btn btn-secondary" onclick="showSection('home')">Back to Dashboard</button>

                <h2 style="margin: 20px 0;">Vocabulary Flashcards</h2>

                <div class="progress-bar">
                    <div class="progress-fill" id="vocabProgressBar" style="width: 0%"></div>
                    <div class="progress-text" id="vocabProgress">0/24 terms mastered (0%)</div>
                </div>

                <div id="flashcardContainer"></div>

                <div class="card-controls">
                    <button class="btn btn-secondary" onclick="prevCard()">Previous</button>
                    <button class="btn btn-primary" onclick="markKnown()">I Know This</button>
                    <button class="btn btn-secondary" onclick="nextCard()">Next</button>
                </div>

                <p class="flip-indicator">Click the card to flip between term and definition</p>

                <div class="keyboard-hint">
                    <span><span class="key">&#8592;</span> <span class="key">&#8594;</span> Navigate cards</span>
                    <span><span class="key">Space</span> Flip card</span>
                    <span><span class="key">K</span> Mark known</span>
                    <span><span class="key">Esc</span> Home</span>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="shuffleCards()">Shuffle Cards</button>
                    <br>
                    <button class="reset-btn" onclick="resetVocabProgress()">Reset Vocabulary Progress</button>
                </div>
            </div>

            <!-- MULTIPLE CHOICE -->
            <div id="practice" class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Multiple Choice</h2>
                    <button class="btn btn-secondary" onclick="showSection('home')">Back</button>
                </div>

                <div id="mc-case-picker">
                    <p style="margin-bottom: 15px; color: #666;">Choose a case to test yourself on, or try all cases at once.</p>
                    <div class="nav-buttons" id="mc-case-buttons"></div>
                </div>

                <div id="mc-quiz-area" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="mc-progress" style="width: 0%"></div>
                        <span class="progress-text" id="mc-progress-text">Question 1 of 5</span>
                    </div>
                    <div id="mc-question-area"></div>
                </div>
            </div>

            <!-- SHORT ANSWER -->
            <div id="shortanswer" class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Short Answer</h2>
                    <button class="btn btn-secondary" onclick="showSection('home')">Back</button>
                </div>

                <div class="question-card" style="border-left-color: var(--primary-dark); margin-bottom: 25px;">
                    <span class="question-topic">Guiding Question</span>
                    <h3 style="font-size: 1.15em; line-height: 1.5;">When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?</h3>
                </div>

                <div id="sa-case-picker">
                    <p style="margin-bottom: 15px; color: #666;">Choose a project case. You'll decide what you think the Court should rule, reflect on which side you argued in the debate, and build a response using the guided framework.</p>
                    <div class="nav-buttons" id="sa-case-buttons"></div>
                </div>

                <div id="sa-writing-area" style="display: none;"></div>
            </div>

            <!-- AMENDMENTS ACTIVITY -->
            <div id="sort" class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>Amendments Challenge</h2>
                    <button class="btn btn-secondary" onclick="showSection('home')">Back</button>
                </div>

                <div class="amend-level-tabs">
                    <button class="amend-level-tab active" id="round1-tab" onclick="showRound(1)">
                        <div>Round 1: The Basics</div>
                        <div class="tab-subtitle">One right per amendment</div>
                    </button>
                    <button class="amend-level-tab locked" id="round2-tab" onclick="showRound(2)">
                        <div>Round 2: Go Deeper</div>
                        <div class="tab-subtitle" id="round2-subtitle">Score 70%+ on Round 1 to unlock</div>
                    </button>
                    <button class="amend-level-tab locked" id="round3-tab" onclick="showRound(3)">
                        <div>Round 3: Apply It</div>
                        <div class="tab-subtitle" id="round3-subtitle">Score 70%+ on Round 2 to unlock</div>
                    </button>
                </div>

                <!-- MATCH ROUND (shared by Round 1 and Round 2) -->
                <div id="amend-match-round">
                    <div class="alert info" id="match-round-instructions">
                        <strong style="display:block; margin-bottom:6px;">How it works:</strong>
                        <span><b>1.</b> Pick a right from the list below. &nbsp;<b>2.</b> Click the amendment chip it belongs to — the chips will pulse when waiting for your choice. &nbsp;<b>3.</b> Hover over any chip to read what that amendment protects. Click a chip to open its drawer and review (or remove) what you've placed. When you've matched them all, hit <b>Check Answers</b> — chips turn <span style="color:#10b981;font-weight:600;">green</span> if everything underneath is correct, or <span style="color:#ef4444;font-weight:600;">red</span> if something needs fixing.</span>
                    </div>

                    <div class="level-progress">
                        <span class="progress-text" id="match-progress-text">0 / 0 placed</span>
                        <div class="progress-bar-outer">
                            <div class="progress-bar-inner" id="match-progress-bar" style="width: 0%;"></div>
                        </div>
                    </div>

                    <div class="match-grid">
                        <div class="match-amendments-panel">
                            <h3>Amendments <span style="font-weight:400;font-size:0.85em;color:#888;">(hover for description, click to assign)</span></h3>
                            <div id="match-amendments-list"></div>
                            <div id="amend-drawer" class="amend-drawer">
                                <div class="amend-drawer-title" id="drawer-title"></div>
                                <div class="amend-drawer-desc" id="drawer-desc"></div>
                                <div class="placed-items-drawer" id="drawer-placed"></div>
                            </div>
                        </div>
                        <div class="match-items-panel">
                            <h3>Rights & Protections</h3>
                            <div id="match-items-list"></div>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="checkMatchRound()">Check Answers</button>
                        <button class="btn btn-secondary" onclick="resetMatchRound()">Reset</button>
                    </div>

                    <div id="match-round-feedback"></div>
                </div>

                <!-- ROUND 3: APPLY IT (cases) -->
                <div id="amend-round3" style="display: none;">
                    <div class="alert info">
                        <strong style="display:block; margin-bottom:6px;">How it works:</strong>
                        <span>Each card describes a real Supreme Court case. Read the summary, then pick the amendment at the center of the dispute. You'll get instant feedback — <span style="color:#10b981;font-weight:600;">green</span> means correct, <span style="color:#ef4444;font-weight:600;">red</span> reveals the right answer. Your studied project cases come first, then landmark cases from across American history.</span>
                    </div>

                    <div class="level-progress">
                        <span class="progress-text" id="r3-progress-text">0 / 0 correct</span>
                        <div class="progress-bar-outer">
                            <div class="progress-bar-inner" id="r3-progress-bar" style="width: 0%;"></div>
                        </div>
                    </div>

                    <div id="round3-cases"></div>

                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="resetRound3()">Reset</button>
                    </div>

                    <div id="round3-feedback"></div>
                </div>
            </div>
        </div>
    </main>

    <footer role="contentinfo">
        <div class="container">
            <p><a href="index.html">Back to Home</a></p>
            <p>&copy; 2026 SCOTUS Debate Project | Educational Resource</p>
        </div>
    </footer>

    <script>
    // ==========================================
    // SECTION NAVIGATION
    // ==========================================
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }

    // ==========================================
    // MULTIPLE CHOICE DATA — 5 questions per case
    // ==========================================
    const mcQuestionsByCase = {
        "Tinker v. Des Moines (1969)": [
            {
                question: "What did the students in Tinker v. Des Moines do to protest the Vietnam War?",
                options: ["Organized a school walkout", "Wore black armbands to school", "Refused to say the Pledge of Allegiance", "Handed out anti-war flyers in the cafeteria"],
                correct: 1,
                explanation: "Mary Beth Tinker, John Tinker, and Christopher Eckhardt wore black armbands to school as a silent protest against the Vietnam War."
            },
            {
                question: "Which constitutional right was at the center of the Tinker case?",
                options: ["Fourth Amendment — search and seizure", "First Amendment — freedom of speech", "Fourteenth Amendment — equal protection", "Sixth Amendment — right to a fair trial"],
                correct: 1,
                explanation: "The case centered on the First Amendment right to freedom of speech, specifically whether students retain free speech rights at school."
            },
            {
                question: "What argument did the school district make to justify banning the armbands?",
                options: ["The armbands violated the school dress code", "Wearing armbands could cause a disruption to the learning environment", "The students did not get permission to protest", "Political speech is never allowed on school property"],
                correct: 1,
                explanation: "The school argued that the armbands could cause a substantial disruption to the school environment, even though no actual disruption had occurred."
            },
            {
                question: "Why did the school punish the students for wearing armbands?",
                options: ["The armbands caused a riot in the hallway", "The school had a dress code banning all accessories", "The school preemptively banned armbands out of fear of disruption", "Students were bullying classmates who supported the war"],
                correct: 2,
                explanation: "School principals learned of the plan and preemptively created a policy banning armbands. The armbands were silent and caused no actual disruption."
            },
            {
                question: "What constitutional question was the Court asked to decide in Tinker?",
                options: ["Whether schools can set dress code policies", "Whether students have First Amendment rights while at school", "Whether parents can sue schools for disciplining their children", "Whether the Vietnam War was constitutional"],
                correct: 1,
                explanation: "The central question was whether students retain their First Amendment right to free speech while on school grounds, or whether schools can restrict expression to maintain order."
            }
        ],
        "New Jersey v. T.L.O. (1985)": [
            {
                question: "What was T.L.O. initially caught doing that led to the search of her purse?",
                options: ["Cheating on a test", "Smoking in the school restroom", "Skipping class", "Selling items in the hallway"],
                correct: 1,
                explanation: "A teacher caught T.L.O. smoking in the restroom, which violated school rules."
            },
            {
                question: "What constitutional amendment was at issue in New Jersey v. T.L.O.?",
                options: ["First Amendment", "Fourth Amendment", "Fifth Amendment", "Eighth Amendment"],
                correct: 1,
                explanation: "The case centered on the Fourth Amendment, which protects against unreasonable searches and seizures."
            },
            {
                question: "What was the main constitutional question in New Jersey v. T.L.O.?",
                options: ["Whether students can be expelled for smoking", "Whether school officials need the same level of justification as police to search a student", "Whether evidence found at school can be used in court", "Whether students must consent to searches"],
                correct: 1,
                explanation: "The central question was what standard school officials must meet to search a student — the same \"probable cause\" standard required of police, or something different given the school setting."
            },
            {
                question: "What did the assistant vice principal find when he searched T.L.O.'s purse?",
                options: ["A weapon and stolen property", "Cigarettes, marijuana, drug paraphernalia, and money", "Alcohol and prescription drugs", "Nothing — the search found no contraband"],
                correct: 1,
                explanation: "He found cigarettes, rolling papers, marijuana, a pipe, plastic bags, cash, and a list of students who owed T.L.O. money."
            },
            {
                question: "Why are school searches held to a different standard than police searches?",
                options: ["Students have no constitutional rights at school", "Schools act \"in loco parentis\" and need flexibility to maintain safety", "The Constitution only applies to adults", "Schools are private property, so the Fourth Amendment doesn't apply"],
                correct: 1,
                explanation: "Schools operate under a \"special needs\" doctrine — they act in loco parentis (in place of parents) and need flexibility to maintain order and safety."
            }
        ],
        "Brown v. Board of Education (1954)": [
            {
                question: "What was the main argument made by the plaintiffs (the families) in Brown v. Board?",
                options: ["Segregated schools cost taxpayers too much money", "Segregated schools violated the Equal Protection Clause by being inherently unequal", "Black students were not allowed to attend any public schools", "The schools were too far from their homes"],
                correct: 1,
                explanation: "The plaintiffs argued that racial segregation in public schools was inherently unequal and violated the Fourteenth Amendment's Equal Protection Clause, regardless of whether the facilities were physically equal."
            },
            {
                question: "Which earlier Supreme Court decision had established the \"separate but equal\" doctrine that Brown challenged?",
                options: ["Marbury v. Madison (1803)", "Dred Scott v. Sandford (1857)", "Plessy v. Ferguson (1896)", "Korematsu v. United States (1944)"],
                correct: 2,
                explanation: "Plessy v. Ferguson (1896) established the \"separate but equal\" doctrine, which allowed racial segregation as long as facilities were supposedly equal. Brown directly challenged this precedent."
            },
            {
                question: "Which part of the Constitution did the plaintiffs argue was being violated by school segregation?",
                options: ["The First Amendment — freedom of speech", "The Fourth Amendment — search and seizure", "The Fourteenth Amendment — Equal Protection Clause", "The Tenth Amendment — states' rights"],
                correct: 2,
                explanation: "The plaintiffs argued that segregation violated the Equal Protection Clause of the Fourteenth Amendment, which guarantees all citizens equal protection under the law."
            },
            {
                question: "Who was Linda Brown, and why was her story important to the case?",
                options: ["A teacher who refused to teach in a segregated school", "A Black student who had to travel far to a segregated school despite living near a whites-only school", "A lawyer for the NAACP who argued the case", "A Supreme Court justice who wrote the opinion"],
                correct: 1,
                explanation: "Linda Brown was a Black third-grader in Topeka, Kansas who had to walk through a dangerous railroad yard and take a bus to a distant school, even though a whites-only school was just seven blocks from her home."
            },
            {
                question: "Who argued the case on behalf of the Brown family and the other plaintiffs?",
                options: ["Martin Luther King Jr.", "Thurgood Marshall and the NAACP Legal Defense Fund", "Frederick Douglass", "Rosa Parks and the SCLC"],
                correct: 1,
                explanation: "Thurgood Marshall, who later became the first Black Supreme Court Justice, led the NAACP Legal Defense Fund's argument in the case."
            }
        ],
        "Payton v. New York (1980)": [
            {
                question: "What did police do in the Payton case that raised constitutional concerns?",
                options: ["They searched Payton's car without a warrant", "They broke down Payton's door and entered his home without a warrant", "They wiretapped Payton's phone without permission", "They arrested Payton at his workplace without identification"],
                correct: 1,
                explanation: "Six officers went to Payton's apartment, broke down the door with a crowbar, and entered without an arrest warrant."
            },
            {
                question: "Which constitutional amendment protects against warrantless home entry?",
                options: ["First Amendment", "Second Amendment", "Fourth Amendment", "Sixth Amendment"],
                correct: 2,
                explanation: "The Fourth Amendment protects people from unreasonable searches and seizures, including warrantless entry into their homes."
            },
            {
                question: "What constitutional question was at the center of Payton v. New York?",
                options: ["Whether police can use deadly force during an arrest", "Whether police need a warrant to enter a home to make a routine arrest", "Whether the death penalty is constitutional", "Whether police must read Miranda rights before an arrest"],
                correct: 1,
                explanation: "The central question was whether the Fourth Amendment requires police to obtain an arrest warrant before entering a person's home to make a routine felony arrest."
            },
            {
                question: "What argument did New York make to justify the officers entering Payton's home without a warrant?",
                options: ["They claimed Payton had given verbal consent", "They argued probable cause alone should be enough for a home arrest", "They said the Fourth Amendment only applies to searches, not arrests", "They argued Payton was not actually at home"],
                correct: 1,
                explanation: "New York argued that if police had probable cause to believe a suspect committed a felony, that should be sufficient to enter a home — no warrant needed."
            },
            {
                question: "Why does the home receive the highest level of Fourth Amendment protection?",
                options: ["Because homes are expensive private property", "Because the Founders believed the home is a person's most private space", "Because police are not allowed near residential areas", "Because the Second Amendment protects homeowners"],
                correct: 1,
                explanation: "The principle that \"a man's home is his castle\" goes back to the founding of the country — the home is where a person has the greatest expectation of privacy."
            }
        ],
        "Arizona v. United States (2012)": [
            {
                question: "What was Arizona's S.B. 1070 law designed to do?",
                options: ["Protect the border with a wall", "Allow the state to enforce immigration laws on its own", "Give undocumented immigrants a path to citizenship", "Increase federal funding for border security"],
                correct: 1,
                explanation: "S.B. 1070 created state-level immigration enforcement, including requiring police to check immigration status and making it a state crime to be undocumented."
            },
            {
                question: "Which part of the Constitution was at the center of Arizona v. United States?",
                options: ["The First Amendment", "The Equal Protection Clause", "The Supremacy Clause (Article VI)", "The Second Amendment"],
                correct: 2,
                explanation: "The case centered on the Supremacy Clause, which establishes that federal law takes priority over state law when they conflict."
            },
            {
                question: "What argument did the federal government make against Arizona's S.B. 1070?",
                options: ["The law violated the Equal Protection Clause", "Federal immigration law is so comprehensive that states cannot create their own enforcement", "Arizona did not have a border with Mexico", "The law violated the First Amendment rights of immigrants"],
                correct: 1,
                explanation: "The federal government argued that immigration law is an area where federal authority is so comprehensive that state laws are preempted — meaning states cannot create conflicting enforcement schemes."
            },
            {
                question: "Why did Arizona argue it needed its own immigration law?",
                options: ["The state wanted to secede from the union", "The federal government was not doing enough to enforce immigration laws", "Arizona wanted to attract more immigrants", "The state wanted to override the Fourteenth Amendment"],
                correct: 1,
                explanation: "Arizona argued the federal government was failing to enforce immigration laws, leaving the state to bear high costs in education, healthcare, and law enforcement."
            },
            {
                question: "What broader constitutional principle does Arizona v. United States illustrate?",
                options: ["Separation of church and state", "Checks and balances between the three branches", "Federalism — the balance of power between state and federal governments", "The right to a fair trial"],
                correct: 2,
                explanation: "The case illustrates federalism — the ongoing tension between state and federal power, especially in areas where federal law is comprehensive."
            }
        ],
        "Kennedy v. Bremerton (2022)": [
            {
                question: "What did Coach Kennedy do that led to a legal dispute?",
                options: ["He led mandatory team prayers before games", "He knelt at midfield for a brief, quiet prayer after games", "He required students to attend his church", "He taught religious lessons during practice"],
                correct: 1,
                explanation: "After games, Kennedy would walk to the 50-yard line, kneel, and offer a brief (15-30 second), quiet personal prayer of thanks."
            },
            {
                question: "Which two parts of the First Amendment were in tension in this case?",
                options: ["Free speech and free press", "Free Exercise Clause and Establishment Clause", "Right to petition and right to assemble", "Free speech and right to bear arms"],
                correct: 1,
                explanation: "The case involved tension between the Free Exercise Clause (Kennedy's right to practice his faith) and the Establishment Clause (the school's concern about appearing to endorse religion)."
            },
            {
                question: "What was the school district's main argument for disciplining Coach Kennedy?",
                options: ["Kennedy was neglecting his coaching duties", "Allowing his prayer could be seen as the school endorsing religion, violating the Establishment Clause", "Kennedy was forcing students to pray with him", "Kennedy was praying during class time"],
                correct: 1,
                explanation: "The school argued that a coach praying visibly at a school event could appear to be government endorsement of religion, which would violate the Establishment Clause of the First Amendment."
            },
            {
                question: "What legal test had traditionally been used to evaluate whether government actions violate the Establishment Clause?",
                options: ["The \"substantial disruption\" test from Tinker", "The \"reasonable suspicion\" test from T.L.O.", "The \"Lemon test\" from Lemon v. Kurtzman", "The \"clear and present danger\" test from Schenck"],
                correct: 2,
                explanation: "The \"Lemon test\" (from Lemon v. Kurtzman, 1971) had been used for decades to evaluate Establishment Clause cases. It asked whether a government action had a secular purpose, a primary effect that neither advances nor inhibits religion, and avoided excessive government entanglement with religion."
            },
            {
                question: "What concern was raised about Coach Kennedy's prayers, even though they were described as personal and voluntary?",
                options: ["The prayers were too long and delayed the games", "Students may feel implicit pressure to join when an authority figure prays publicly", "Other coaches complained about Kennedy's behavior", "The prayers mentioned specific religious denominations"],
                correct: 1,
                explanation: "A key concern was that when a coach (an authority figure) prays visibly at a school event, students may feel implicit pressure to participate, even if the prayer is technically voluntary."
            }
        ],
        "Mahanoy v. B.L. (2021)": [
            {
                question: "Why was B.L. punished by her school?",
                options: ["She cheated on a test and posted about it online", "She posted vulgar Snapchat messages about school and cheerleading while off campus", "She cyberbullied a teacher on social media", "She organized a protest during school hours"],
                correct: 1,
                explanation: "B.L. posted Snapchat images with vulgar language expressing frustration about not making the varsity cheerleading team. She posted from off campus on a weekend."
            },
            {
                question: "What makes Mahanoy v. B.L. historically significant?",
                options: ["It was the first case about student prayer", "It was the first Supreme Court case about student speech on social media", "It overturned the First Amendment for minors", "It was the first case to ban social media in schools"],
                correct: 1,
                explanation: "Mahanoy was the first major Supreme Court case addressing whether schools can punish students for speech on social media that happens off campus."
            },
            {
                question: "What was B.L.'s main argument in her case against the school?",
                options: ["Snapchat automatically deletes posts, so they don't count", "Her off-campus speech was protected by the First Amendment and didn't disrupt school", "The cheerleading coach had a personal grudge against her", "She didn't actually write the posts — a friend did"],
                correct: 1,
                explanation: "B.L. argued that her off-campus speech was protected by the First Amendment and that her Snapchat posts, made on a weekend away from school, did not cause any substantial disruption to the school environment."
            },
            {
                question: "What legal standard from a previous case was central to the arguments in Mahanoy?",
                options: ["The \"probable cause\" standard from T.L.O.", "Tinker's \"substantial disruption\" test for student speech", "The \"Lemon test\" for religious expression", "The \"strict scrutiny\" standard from Brown"],
                correct: 1,
                explanation: "Both sides relied on Tinker's \"substantial disruption\" test. The key debate was whether that standard applies to speech that happens entirely off campus, and if so, how."
            },
            {
                question: "What argument did the school make to justify punishing B.L. for her off-campus Snapchat posts?",
                options: ["Snapchat is banned for all students under school policy", "The posts were seen by other cheerleaders and disrupted team morale and discipline", "B.L. had signed a contract giving up her free speech rights", "The school claimed B.L. posted during school hours"],
                correct: 1,
                explanation: "The school argued that B.L.'s posts undermined team morale and the coach's authority, and that schools need the ability to discipline students for speech that affects the school environment, even if posted off campus."
            }
        ]
    };

    const caseList = Object.keys(mcQuestionsByCase);

    let currentMCQuestion = 0;
    let mcAnswers = {};
    let mcShuffled = [];
    let mcSelected = null;
    let mcCurrentCase = '';

    function initMCCasePicker() {
        const container = document.getElementById('mc-case-buttons');
        let html = '';
        caseList.forEach((caseName, i) => {
            const cls = i % 3 === 0 ? '' : i % 3 === 1 ? ' secondary' : ' success';
            html += `<button class="nav-btn${cls}" onclick="startMCForCase('${caseName.replace(/'/g, "\\'")}')">${caseName}</button>`;
        });
        html += `<button class="nav-btn secondary" onclick="startMCAllCases()">All Cases (35 Questions)</button>`;
        container.innerHTML = html;
    }

    function startMCForCase(caseName) {
        mcCurrentCase = caseName;
        const questions = mcQuestionsByCase[caseName];
        mcShuffled = questions.map((q, i) => ({ ...q, topic: caseName, _origIdx: i }));
        mcShuffled.sort(() => Math.random() - 0.5);
        currentMCQuestion = 0;
        mcAnswers = {};
        document.getElementById('mc-case-picker').style.display = 'none';
        document.getElementById('mc-quiz-area').style.display = 'block';
        renderMCQuestion();
    }

    function startMCAllCases() {
        mcCurrentCase = 'All Cases';
        mcShuffled = [];
        caseList.forEach(caseName => {
            mcQuestionsByCase[caseName].forEach(q => {
                mcShuffled.push({ ...q, topic: caseName });
            });
        });
        mcShuffled.sort(() => Math.random() - 0.5);
        currentMCQuestion = 0;
        mcAnswers = {};
        document.getElementById('mc-case-picker').style.display = 'none';
        document.getElementById('mc-quiz-area').style.display = 'block';
        renderMCQuestion();
    }

    function renderMCQuestion() {
        if (currentMCQuestion >= mcShuffled.length) {
            showMCResults();
            return;
        }
        const q = mcShuffled[currentMCQuestion];
        const progress = ((currentMCQuestion) / mcShuffled.length) * 100;
        document.getElementById('mc-progress').style.width = progress + '%';
        document.getElementById('mc-progress-text').textContent =
            `Question ${currentMCQuestion + 1} of ${mcShuffled.length}`;

        let html = `<div class="question-card">`;
        if (q.topic) html += `<span class="question-topic">${q.topic}</span>`;
        html += `<h3>${q.question}</h3><div class="options">`;
        q.options.forEach((opt, i) => {
            html += `<div class="option" onclick="selectMCOption(${i})" id="mc-opt-${i}">${opt}</div>`;
        });
        html += `</div></div>`;
        html += `<div id="mc-feedback" class="feedback"></div>`;
        html += `<div style="text-align:center; margin-top:15px;">`;
        html += `<button class="btn btn-primary" id="mc-check-btn" onclick="checkMCAnswer()" disabled>Check Answer</button>`;
        html += `</div>`;

        document.getElementById('mc-question-area').innerHTML = html;
    }

    function selectMCOption(index) {
        mcSelected = index;
        document.querySelectorAll('#mc-question-area .option').forEach((el, i) => {
            el.classList.toggle('selected', i === index);
        });
        document.getElementById('mc-check-btn').disabled = false;
    }

    function checkMCAnswer() {
        const q = mcShuffled[currentMCQuestion];
        const isCorrect = mcSelected === q.correct;
        mcAnswers[currentMCQuestion] = isCorrect;

        document.querySelectorAll('#mc-question-area .option').forEach((el, i) => {
            el.style.pointerEvents = 'none';
            if (i === q.correct) el.classList.add('correct');
            if (i === mcSelected && !isCorrect) el.classList.add('incorrect');
        });

        const fb = document.getElementById('mc-feedback');
        fb.className = 'feedback show ' + (isCorrect ? 'correct' : 'incorrect');
        fb.innerHTML = `<h4>${isCorrect ? 'Correct!' : 'Not quite.'}</h4><p>${q.explanation || ''}</p>`;

        document.getElementById('mc-check-btn').style.display = 'none';
        const nextBtn = document.createElement('button');
        nextBtn.className = 'btn btn-primary';
        nextBtn.textContent = currentMCQuestion < mcShuffled.length - 1 ? 'Next Question' : 'See Results';
        nextBtn.onclick = function() {
            currentMCQuestion++;
            mcSelected = null;
            renderMCQuestion();
        };
        document.getElementById('mc-check-btn').parentNode.appendChild(nextBtn);
    }

    function showMCResults() {
        const correct = Object.values(mcAnswers).filter(v => v).length;
        const total = mcShuffled.length;
        const pct = Math.round((correct / total) * 100);

        document.getElementById('mc-progress').style.width = '100%';
        document.getElementById('mc-progress-text').textContent = 'Complete!';
        document.getElementById('mc-score').textContent = pct + '%';

        let html = `<div style="text-align:center; margin-bottom: 10px;"><h3>${mcCurrentCase}</h3></div>`;
        html += `<div class="stats-grid">
            <div class="stat-card"><div class="number">${correct}/${total}</div><div class="label">Correct</div></div>
            <div class="stat-card"><div class="number">${pct}%</div><div class="label">Score</div></div>
        </div>`;
        html += `<div style="text-align:center; margin-top:20px;">`;
        html += `<button class="btn btn-primary" onclick="backToMCPicker()">Choose Another Case</button> `;
        html += `<button class="btn btn-secondary" onclick="showSection('home')">Back to Dashboard</button>`;
        html += `</div>`;

        document.getElementById('mc-question-area').innerHTML = html;
        localStorage.setItem('scotus-mc-score', pct);
    }

    function backToMCPicker() {
        document.getElementById('mc-quiz-area').style.display = 'none';
        document.getElementById('mc-case-picker').style.display = 'block';
    }

    // ==========================================
    // SHORT ANSWER — Scaffolded Writing Framework
    // ==========================================
    const guidingQuestion = "When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?";

    const saFrameworks = {
        "Tinker v. Des Moines (1969)": {
            amendment: "First Amendment — Freedom of Speech",
            context: "Students wore black armbands to protest the Vietnam War. The school banned the armbands and suspended the students, even though no disruption occurred.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Tinker v. Des Moines, the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to limit free speech when _____.",
                        "Tinker v. Des Moines is an example of the government restricting First Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should the government have been allowed to limit the students' rights in this case? Connect it to the bigger question of when — if ever — rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to limit the students' right to free speech because _____.",
                        "The Court should rule that the government _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The government's reason for limiting rights — _____ — is / is not strong enough because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Tinker v. Des Moines, the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that limiting a person's rights to protect the community is / is not justified when _____.",
                        "Ultimately, the government should / should not have the power to restrict free speech because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "New Jersey v. T.L.O. (1985)": {
            amendment: "Fourth Amendment — Protection from Unreasonable Searches",
            context: "A school official searched a student's purse after catching her smoking. The search revealed drugs and evidence of dealing.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In New Jersey v. T.L.O., the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to limit privacy rights when _____.",
                        "New Jersey v. T.L.O. is an example of the government restricting Fourth Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should school officials be allowed to search students with less justification than police need? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to search the student because _____.",
                        "The Court should rule that school officials _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The trade-off between student privacy and school safety should be handled by _____ because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on New Jersey v. T.L.O., the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that limiting a person's rights to protect the community is / is not justified when _____.",
                        "Ultimately, the balance between privacy and safety shows that the government should / should not be able to limit rights because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "Brown v. Board of Education (1954)": {
            amendment: "Fourteenth Amendment — Equal Protection",
            context: "Black students were forced to attend separate, unequal schools under the \"separate but equal\" doctrine. The government enforced segregation laws.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Brown v. Board of Education, the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to limit equal protection when _____.",
                        "Brown v. Board of Education is an example of the government restricting Fourteenth Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should the government have been allowed to enforce \"separate but equal\"? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to enforce segregation because _____.",
                        "The Court should rule that the government _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The government's claim that segregation \"protected the community\" is / is not valid because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Brown v. Board of Education, the government should never be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that \"protecting the community\" is / is not a valid reason to limit rights when _____.",
                        "Ultimately, the government should / should not have the power to restrict equal protection because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "Payton v. New York (1980)": {
            amendment: "Fourth Amendment — Protection of the Home",
            context: "Police suspected a man of murder and had strong evidence, but instead of getting a warrant, they broke down his apartment door to arrest him.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Payton v. New York, the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to enter a home without a warrant when _____.",
                        "Payton v. New York is an example of the government restricting Fourth Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should the police have been allowed to enter the home without a warrant? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to enter the home without a warrant because _____.",
                        "The Court should rule that the police _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The balance between catching criminals and protecting privacy should be handled by _____ because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Payton v. New York, the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that limiting a person's privacy to protect the community is / is not justified when _____.",
                        "Ultimately, the government should / should not have the power to enter a home without a warrant because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "Arizona v. United States (2012)": {
            amendment: "Supremacy Clause — Federal vs. State Power",
            context: "Arizona passed its own immigration enforcement law (S.B. 1070) because it felt the federal government was not doing enough. The law required police to check immigration status during stops.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Arizona v. United States, the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether a state government should be allowed to limit rights when _____.",
                        "Arizona v. United States is an example of the government restricting rights to protect the community because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should Arizona have been allowed to enforce its own immigration law? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "Arizona should / should not have been allowed to enforce its own immigration law because _____.",
                        "The Court should rule that the state government _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The question of who gets to limit rights — the state or the federal government — matters because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Arizona v. United States, the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that a state acting on its own to limit rights is / is not justified when _____.",
                        "Ultimately, the balance between state and federal power shows that the government should / should not be able to limit rights because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "Kennedy v. Bremerton (2022)": {
            amendment: "First Amendment — Free Exercise of Religion vs. Establishment Clause",
            context: "A public school football coach prayed briefly at midfield after games. The school fired him, worried it would look like the school was endorsing religion.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Kennedy v. Bremerton, the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to limit religious expression when _____.",
                        "Kennedy v. Bremerton is an example of the government restricting First Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should the school have been allowed to fire the coach for praying? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to limit Coach Kennedy's right to pray because _____.",
                        "The Court should rule that the school district _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The tension between religious freedom and the Establishment Clause should be resolved by _____ because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Kennedy v. Bremerton, the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that limiting religious expression to protect the community is / is not justified when _____.",
                        "Ultimately, the government should / should not have the power to restrict religious freedom because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        },
        "Mahanoy v. B.L. (2021)": {
            amendment: "First Amendment — Student Speech Off Campus",
            context: "A student posted vulgar Snapchat messages about her school and cheerleading team from off campus on a weekend. The school suspended her from the team for a year.",
            parts: [
                {
                    label: "CONTEXT",
                    instruction: "Introduce the case and explain how it connects to the driving question: When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?",
                    starters: [
                        "In Mahanoy v. B.L., the government limited a person's constitutional rights by _____.",
                        "This case raises the question of whether the government should be allowed to limit off-campus speech when _____.",
                        "Mahanoy v. B.L. is an example of the government restricting First Amendment rights because _____."
                    ]
                },
                {
                    label: "CLAIM",
                    instruction: "State a clear position: should the school have been allowed to punish B.L. for off-campus social media posts? Connect it to the bigger question of when rights can be limited.",
                    starters: [
                        "The government should / should not have been allowed to punish B.L. for off-campus speech because _____.",
                        "The Court should rule that the school _____ because _____.",
                        "Based on this case, the government should / should not be allowed to limit constitutional rights when _____."
                    ]
                },
                {
                    label: "REASONING",
                    instruction: "Explain the thinking behind this position. Which side has the stronger argument, and why? If the debate side was different from this position, acknowledge that.",
                    starters: [
                        "This side has the stronger argument because _____.",
                        "Although the _____ side was argued in the debate, the stronger position is _____ because _____.",
                        "The question of whether the government can control speech outside of school matters because _____."
                    ]
                },
                {
                    label: "EVIDENCE",
                    instruction: "Provide at least two specific arguments that support this position. Use facts from the case, arguments from the debate, or constitutional reasoning. Click multiple starters to build your evidence.",
                    starters: [
                        "One argument that supports this position is _____.",
                        "Additionally, _____ shows that _____.",
                        "A strong point raised during the debate was _____.",
                        "The facts of the case support this because _____."
                    ]
                },
                {
                    label: "CONCLUSION",
                    instruction: "Wrap up by directly answering the driving question. Based on this case, when — if ever — should the government be allowed to limit a person's constitutional rights to protect the community?",
                    starters: [
                        "Based on Mahanoy v. B.L., the government should only be allowed to limit constitutional rights when _____.",
                        "This case demonstrates that limiting off-campus speech to protect the community is / is not justified when _____.",
                        "Ultimately, the government should / should not have the power to punish speech outside of school because _____."
                    ]
                }
            ],
            checklist: [
                "The response clearly states which side the Court should rule for",
                "The response reflects on which side was argued in the debate vs. which side is actually stronger",
                "The response includes at least two arguments that support the position",
                "The response uses specific facts or reasoning from the case or debate",
                "The response directly answers the driving question about when the government should be allowed to limit rights"
            ]
        }
    };

    const saCaseList = Object.keys(saFrameworks);

    let saCurrentCase = '';

    function initSACasePicker() {
        const container = document.getElementById('sa-case-buttons');
        let html = '';
        saCaseList.forEach((caseName, i) => {
            const cls = i % 3 === 0 ? '' : i % 3 === 1 ? ' secondary' : ' success';
            html += `<button class="nav-btn${cls}" onclick="startSAForCase('${caseName.replace(/'/g, "\\'")}')">${caseName}</button>`;
        });
        container.innerHTML = html;
    }

    const partColors = {
        "CONTEXT": "#6366f1",
        "CLAIM": "#dc2626",
        "REASONING": "#f59e0b",
        "EVIDENCE": "#10b981",
        "CONCLUSION": "#8b5cf6"
    };

    function startSAForCase(caseName) {
        saCurrentCase = caseName;
        const fw = saFrameworks[caseName];

        // Load any saved responses for this case
        const savedKey = 'scotus-sa-' + caseName.replace(/[^a-zA-Z0-9]/g, '');
        let savedResponses = [];
        try {
            const saved = localStorage.getItem(savedKey);
            if (saved) savedResponses = JSON.parse(saved);
        } catch(e) {}

        let html = '';
        html += `<button class="btn btn-secondary" onclick="backToSAPicker()" style="margin-bottom: 20px;">Back to Case Selection</button>`;
        html += `<div class="question-card">`;
        html += `<span class="question-topic">${fw.amendment}</span>`;
        html += `<h3>${caseName}</h3>`;
        html += `<p style="color: #666; margin-top: 10px;">${fw.context}</p>`;
        html += `</div>`;

        html += `<div style="margin: 25px 0;">`;
        html += `<h3 style="margin-bottom: 5px; color: var(--primary-dark);">Build Your Response</h3>`;
        html += `<p style="color: #666; font-size: 0.95em; margin-bottom: 20px;">Answer the driving question: <em>When, if ever, should the government be allowed to limit a person's constitutional rights in order to protect the community?</em> Use this case as evidence. Complete each section below — together, they will form the full response.</p>`;

        fw.parts.forEach((part, i) => {
            const savedVal = savedResponses[i] || '';
            const color = partColors[part.label] || 'var(--primary-dark)';
            html += `<div class="question-card sa-part-card" style="border-left: 4px solid ${color}; padding: 18px;">`;
            html += `<div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">`;
            html += `<span class="sa-part-label" style="background: ${color};">${part.label}</span>`;
            html += `<span style="font-size: 0.85em; color: #888;">Part ${i + 1} of ${fw.parts.length}</span>`;
            html += `</div>`;
            html += `<p style="font-weight: 600; color: var(--text-dark); margin-bottom: 12px;">${part.instruction}</p>`;
            html += `<div class="sa-starters-list">`;
            html += `<p style="font-size: 0.85em; color: #888; margin-bottom: 6px;">Sentence starters (choose one or write your own):</p>`;
            part.starters.forEach(starter => {
                html += `<div class="sa-starter-option" onclick="useStarter(this, ${i})">${starter}</div>`;
            });
            html += `</div>`;
            html += `<textarea class="short-answer-area sa-response" data-index="${i}" placeholder="Write your response for this section..." style="min-height: 80px;">${savedVal}</textarea>`;
            html += `</div>`;
        });
        html += `</div>`;

        // Self-assessment checklist
        html += `<div class="question-card" style="border-left-color: #10b981;">`;
        html += `<h4 style="color: var(--primary-dark); margin-bottom: 12px;">Self-Check: Does your response include...</h4>`;
        fw.checklist.forEach((item, i) => {
            html += `<div class="rubric-item" style="display:flex; align-items:center; gap:10px; padding: 6px 0;">`;
            html += `<input type="checkbox" id="sa-check-${i}" style="width:18px; height:18px; cursor:pointer;">`;
            html += `<label for="sa-check-${i}" style="cursor:pointer;">${item}</label>`;
            html += `</div>`;
        });
        html += `</div>`;

        // Put It Together preview area (hidden initially)
        html += `<div id="sa-assembled" class="question-card" style="display:none; border-left-color: var(--primary-dark); border-left-width: 4px;">`;
        html += `<h4 style="color: var(--primary-dark); margin-bottom: 12px;">Your Complete Response</h4>`;
        html += `<div id="sa-assembled-text" style="line-height: 1.8; color: var(--text-dark);"></div>`;
        html += `</div>`;

        html += `<div style="text-align:center; margin-top: 20px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">`;
        html += `<button class="btn btn-primary" onclick="saveSAResponses()">Save My Work</button>`;
        html += `<button class="btn btn-success" onclick="assembleResponse()">Put It Together</button>`;
        html += `<button class="btn btn-secondary" onclick="backToSAPicker()">Back to Cases</button>`;
        html += `</div>`;

        document.getElementById('sa-case-picker').style.display = 'none';
        document.getElementById('sa-writing-area').style.display = 'block';
        document.getElementById('sa-writing-area').innerHTML = html;

        // Auto-save on input
        setTimeout(() => {
            document.querySelectorAll('.sa-response').forEach(el => {
                el.addEventListener('input', autoSaveSA);
            });
        }, 100);
    }

    function useStarter(el, partIndex) {
        const textarea = document.querySelector(`.sa-response[data-index="${partIndex}"]`);
        if (!textarea) return;

        const current = textarea.value.trim();
        if (current) {
            // Append the starter on a new line after existing text
            textarea.value = current + ' ' + el.textContent;
        } else {
            textarea.value = el.textContent;
        }
        textarea.focus();
        // Place cursor at the first blank in the newly added starter
        const blankPos = textarea.value.lastIndexOf('_____');
        if (blankPos !== -1) {
            textarea.setSelectionRange(blankPos, blankPos + 5);
        }
        autoSaveSA();
    }

    function assembleResponse() {
        const responses = [];
        document.querySelectorAll('.sa-response').forEach(el => {
            const val = el.value.trim();
            if (val) responses.push(val);
        });

        const assembled = document.getElementById('sa-assembled');
        const textArea = document.getElementById('sa-assembled-text');

        if (responses.length === 0) {
            textArea.innerHTML = '<p style="color: #999; font-style: italic;">Write your response in each section above first, then click this button to see it all together.</p>';
        } else {
            textArea.innerHTML = responses.map(r => `<p style="margin-bottom: 10px;">${r.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</p>`).join('');
        }

        assembled.style.display = 'block';
        assembled.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }

    function autoSaveSA() {
        saveSAResponses(true);
    }

    function saveSAResponses(silent) {
        const responses = [];
        document.querySelectorAll('.sa-response').forEach(el => {
            responses.push(el.value);
        });
        const savedKey = 'scotus-sa-' + saCurrentCase.replace(/[^a-zA-Z0-9]/g, '');
        localStorage.setItem(savedKey, JSON.stringify(responses));

        // Update dashboard score
        updateSAScore();

        if (!silent) {
            const btn = event.target;
            const origText = btn.textContent;
            btn.textContent = 'Saved!';
            btn.style.background = '#10b981';
            setTimeout(() => {
                btn.textContent = origText;
                btn.style.background = '';
            }, 1500);
        }
    }

    function updateSAScore() {
        let completed = 0;
        saCaseList.forEach(caseName => {
            const key = 'scotus-sa-' + caseName.replace(/[^a-zA-Z0-9]/g, '');
            try {
                const saved = localStorage.getItem(key);
                if (saved) {
                    const responses = JSON.parse(saved);
                    const filledCount = responses.filter(r => r && r.trim().length > 10).length;
                    if (filledCount >= 3) completed++;
                }
            } catch(e) {}
        });
        document.getElementById('sa-score').textContent = completed + '/' + saCaseList.length;
    }

    function backToSAPicker() {
        document.getElementById('sa-writing-area').style.display = 'none';
        document.getElementById('sa-case-picker').style.display = 'block';
    }

    // ==========================================
    // AMENDMENTS CHALLENGE DATA
    // ==========================================
    const amendments = [
        { id: 'amend1', name: '1st Amendment', description: 'Freedom of religion, speech, press, assembly, and petition' },
        { id: 'amend2', name: '2nd Amendment', description: 'Right to bear arms' },
        { id: 'amend3', name: '3rd Amendment', description: 'No quartering of soldiers' },
        { id: 'amend4', name: '4th Amendment', description: 'Protection from unreasonable searches and seizures' },
        { id: 'amend5', name: '5th Amendment', description: 'Rights in criminal cases (due process, double jeopardy, self-incrimination)' },
        { id: 'amend6', name: '6th Amendment', description: 'Right to a fair and speedy trial' },
        { id: 'amend7', name: '7th Amendment', description: 'Right to jury trial in civil cases' },
        { id: 'amend8', name: '8th Amendment', description: 'No excessive bail or cruel and unusual punishment' },
        { id: 'amend9', name: '9th Amendment', description: 'Rights retained by the people' },
        { id: 'amend10', name: '10th Amendment', description: 'Powers reserved to states and the people' },
        { id: 'amend13', name: '13th Amendment', description: 'Abolished slavery and involuntary servitude' },
        { id: 'amend14', name: '14th Amendment', description: 'Equal protection and due process for all citizens; birthright citizenship' },
        { id: 'amend19', name: '19th Amendment', description: 'Women\'s right to vote' }
    ];

    // Round 1: One core right per amendment (13 items)
    const round1Items = [
        { id: 'm1', text: 'Freedom of speech', correctAmendment: 'amend1' },
        { id: 'm2', text: 'Right to bear arms', correctAmendment: 'amend2' },
        { id: 'm3', text: 'No soldiers housed in your home without consent', correctAmendment: 'amend3' },
        { id: 'm4', text: 'Police need a warrant to search your home', correctAmendment: 'amend4' },
        { id: 'm5', text: 'Cannot be tried twice for the same crime', correctAmendment: 'amend5' },
        { id: 'm6', text: 'Right to a speedy trial', correctAmendment: 'amend6' },
        { id: 'm7', text: 'Right to a jury in civil cases over $20', correctAmendment: 'amend7' },
        { id: 'm8', text: 'No cruel and unusual punishment', correctAmendment: 'amend8' },
        { id: 'm9', text: 'People have rights not listed in the Constitution', correctAmendment: 'amend9' },
        { id: 'm10', text: 'Powers not given to the federal government belong to states', correctAmendment: 'amend10' },
        { id: 'm16', text: 'Slavery is illegal in the United States', correctAmendment: 'amend13' },
        { id: 'm17', text: 'No state can deny any person equal protection of the laws', correctAmendment: 'amend14' },
        { id: 'm19', text: 'Women cannot be denied the right to vote', correctAmendment: 'amend19' },
    ];

    // Round 2: Additional rights — multiple per amendment (8 items)
    const round2Items = [
        { id: 'm11', text: 'Freedom of religion', correctAmendment: 'amend1' },
        { id: 'm12', text: 'Right to petition the government', correctAmendment: 'amend1' },
        { id: 'm13', text: 'Right to remain silent (self-incrimination)', correctAmendment: 'amend5' },
        { id: 'm14', text: 'Freedom of the press', correctAmendment: 'amend1' },
        { id: 'm15', text: 'No excessive bail', correctAmendment: 'amend8' },
        { id: 'm18', text: 'Anyone born in the U.S. is a citizen', correctAmendment: 'amend14' },
        { id: 'm20', text: 'No person can be forced into involuntary servitude', correctAmendment: 'amend13' },
        { id: 'm21', text: 'States must guarantee the same legal protections to every person within their borders', correctAmendment: 'amend14' },
    ];

    // Round 3 real cases — studied cases first, then landmark cases
    const round3Cases = [
        // The 7 studied cases
        { name: 'Tinker v. Des Moines (1969)', desc: 'Three students wore black armbands to school to protest the Vietnam War. The school created a policy banning armbands and suspended the students when they refused to remove them.', correctAmendment: 'amend1', explanation: 'The Court ruled 7-2 that students do not "shed their constitutional rights to freedom of speech or expression at the schoolhouse gate." The armbands were protected symbolic speech under the First Amendment.', oyez: 'https://www.oyez.org/cases/1968/21', studied: true },
        { name: 'New Jersey v. T.L.O. (1985)', desc: 'A high school student was caught smoking in the bathroom. An assistant principal searched her purse without a warrant and found drug paraphernalia and evidence of dealing.', correctAmendment: 'amend4', explanation: 'The Court ruled 6-3 that school officials can search students without a warrant, but the search must be reasonable. The Fourth Amendment applies in schools, though with a lower standard than police searches.', oyez: 'https://www.oyez.org/cases/1983/83-712', studied: true },
        { name: 'Brown v. Board of Education (1954)', desc: 'Black children in Topeka, Kansas were forced to attend separate schools from white children under state "separate but equal" laws, even though the Black schools had fewer resources.', correctAmendment: 'amend14', explanation: 'The Court unanimously ruled that racial segregation in public schools violates the Equal Protection Clause of the Fourteenth Amendment. "Separate but equal" has no place in public education.', oyez: 'https://www.oyez.org/cases/1952/1', studied: true },
        { name: 'Payton v. New York (1980)', desc: 'Police had probable cause to believe Theodore Payton committed a murder. Without an arrest warrant, officers broke down his apartment door to arrest him. He was not home, but they seized evidence in plain view.', correctAmendment: 'amend4', explanation: 'The Court ruled 6-3 that the Fourth Amendment prohibits police from making a warrantless, nonconsensual entry into a suspect\'s home to make an arrest. The home has special protection.', oyez: 'https://www.oyez.org/cases/1979/78-5420', studied: true },
        { name: 'Kennedy v. Bremerton (2022)', desc: 'A public high school football coach knelt and prayed at midfield after games. The school district told him to stop because it could appear as government endorsement of religion. He was fired after continuing.', correctAmendment: 'amend1', explanation: 'The Court ruled 6-3 that the coach\'s prayer was protected private speech and free exercise of religion under the First Amendment. The school violated his rights by punishing him for personal religious expression.', oyez: 'https://www.oyez.org/cases/2021/21-418', studied: true },
        { name: 'Mahanoy v. B.L. (2021)', desc: 'A high school student who didn\'t make the varsity cheerleading squad posted a vulgar Snapchat message criticizing the school from off campus on a weekend. The school suspended her from the junior varsity team.', correctAmendment: 'amend1', explanation: 'The Court ruled 8-1 that schools have limited authority to regulate off-campus student speech. The student\'s Snapchat post was protected under the First Amendment because it occurred outside school grounds and hours.', oyez: 'https://www.oyez.org/cases/2020/20-255', studied: true },
        { name: 'Arizona v. United States (2012)', desc: 'Arizona passed S.B. 1070, a law that required police to check immigration status during stops and made it a state crime to be in the country without papers. The federal government sued, arguing immigration is a federal responsibility.', correctAmendment: 'amend10', explanation: 'The Court struck down most of the law, ruling that federal immigration law preempts state law. However, the "show me your papers" provision was allowed to stand. This case centered on the balance of state vs. federal power under the Tenth Amendment and Supremacy Clause.', oyez: 'https://www.oyez.org/cases/2011/11-182', studied: true },
        // Additional landmark cases
        { name: 'Miranda v. Arizona (1966)', desc: 'Ernesto Miranda was arrested and interrogated for two hours without being told he had the right to remain silent or the right to an attorney. He confessed, and the confession was used against him at trial.', correctAmendment: 'amend5', explanation: 'The Court ruled 5-4 that suspects must be informed of their Fifth Amendment right against self-incrimination and their Sixth Amendment right to an attorney before police interrogation. This created the famous "Miranda warnings."', oyez: 'https://www.oyez.org/cases/1965/759' },
        { name: 'Gideon v. Wainwright (1963)', desc: 'Clarence Earl Gideon was charged with a felony in Florida but couldn\'t afford a lawyer. The state refused to appoint one, saying free attorneys were only required in death penalty cases. He represented himself and was convicted.', correctAmendment: 'amend6', explanation: 'The Court unanimously ruled that the Sixth Amendment right to counsel is fundamental and must be provided to all defendants in criminal cases, even if they cannot afford a lawyer. States must provide free attorneys to those in need.', oyez: 'https://www.oyez.org/cases/1962/155' },
        { name: 'Mapp v. Ohio (1961)', desc: 'Police forced their way into Dollree Mapp\'s home without a valid search warrant, looking for a bombing suspect. They didn\'t find the suspect but found materials they claimed were obscene, and charged her with possession.', correctAmendment: 'amend4', explanation: 'The Court ruled 6-3 that evidence obtained through an unreasonable search and seizure cannot be used in state court. The Fourth Amendment\'s protections apply to state governments through the Fourteenth Amendment.', oyez: 'https://www.oyez.org/cases/1960/236' },
        { name: 'Plessy v. Ferguson (1896)', desc: 'Homer Plessy, a man of mixed race, sat in a "whites-only" railroad car in Louisiana and was arrested. He argued the law requiring separate rail cars violated the Fourteenth Amendment\'s Equal Protection Clause.', correctAmendment: 'amend14', explanation: 'The Court ruled 7-1 that "separate but equal" facilities did not violate the Fourteenth Amendment. This devastating decision allowed legal segregation for nearly 60 years until Brown v. Board overturned it in 1954.', oyez: 'https://www.oyez.org/cases/1850-1900/163us537' },
        { name: 'Loving v. Virginia (1967)', desc: 'Richard Loving, a white man, and Mildred Jeter, a Black woman, married in Washington, D.C. When they returned home to Virginia, they were arrested because Virginia banned interracial marriage.', correctAmendment: 'amend14', explanation: 'The Court unanimously struck down laws banning interracial marriage, ruling they violated the Equal Protection and Due Process Clauses of the Fourteenth Amendment. Marriage is a fundamental right that cannot be restricted by race.', oyez: 'https://www.oyez.org/cases/1966/395' },
        { name: 'Engel v. Vitale (1962)', desc: 'A New York school district required students to recite a government-written prayer each morning. Several parents objected, arguing the state should not be writing or promoting prayers in public schools.', correctAmendment: 'amend1', explanation: 'The Court ruled 6-1 that government-written prayers in public schools violate the Establishment Clause of the First Amendment. The government cannot compose official prayers for any group of Americans to recite.', oyez: 'https://www.oyez.org/cases/1961/468' },
        { name: 'District of Columbia v. Heller (2008)', desc: 'Washington, D.C. banned handgun possession in the home and required all firearms to be kept unloaded and disassembled. Dick Heller, a security guard, wanted to keep a handgun at home for self-defense.', correctAmendment: 'amend2', explanation: 'The Court ruled 5-4 that the Second Amendment protects an individual\'s right to keep and bear arms for self-defense in the home, separate from service in a militia.', oyez: 'https://www.oyez.org/cases/2007/07-290' },
        { name: 'Obergefell v. Hodges (2015)', desc: 'Same-sex couples in several states sued after being denied marriage licenses or having their marriages from other states not recognized. They argued these bans violated the Constitution.', correctAmendment: 'amend14', explanation: 'The Court ruled 5-4 that the Fourteenth Amendment requires all states to license and recognize same-sex marriages. The right to marry is a fundamental liberty protected by the Due Process and Equal Protection Clauses.', oyez: 'https://www.oyez.org/cases/2014/14-556' },
        { name: 'The Civil Rights Cases (1883)', desc: 'After the Civil War, Congress passed the Civil Rights Act of 1875 banning racial discrimination in hotels, trains, and theaters. Several business owners refused to serve Black customers and were charged.', correctAmendment: 'amend13', explanation: 'The Court ruled 8-1 that the Thirteenth and Fourteenth Amendments only prohibited government discrimination, not private discrimination. This gutted civil rights protections for decades until the Civil Rights Act of 1964 used the Commerce Clause instead.', oyez: 'https://www.oyez.org/cases/1850-1900/109us3' },
        { name: 'Minor v. Happersett (1875)', desc: 'Virginia Minor tried to register to vote in Missouri but was turned away because she was a woman. She argued the Fourteenth Amendment\'s citizenship guarantee included the right to vote.', correctAmendment: 'amend19', explanation: 'The Court unanimously ruled that while women were citizens, citizenship did not automatically grant the right to vote. This decision made clear that a new amendment was needed — the Nineteenth Amendment, ratified in 1920, finally guaranteed women\'s suffrage.', oyez: 'https://www.oyez.org/cases/1850-1900/88us162' },
    ];

    // ==========================================
    // MATCH ROUNDS (Round 1 & Round 2) + CASES (Round 3)
    // ==========================================
    let selectedItem = null;
    let placements = {}; // { itemId: amendmentId }
    let matchChecked = false;
    let openDrawerAmend = null;
    let currentMatchRound = 1; // 1 or 2
    let currentMatchItems = round1Items; // changes per round

    function getMatchItems() { return currentMatchRound === 1 ? round1Items : round2Items; }

    function initMatchRound(round) {
        currentMatchRound = round || currentMatchRound;
        currentMatchItems = getMatchItems();
        const shuffled = [...currentMatchItems].sort(() => Math.random() - 0.5);
        selectedItem = null;
        placements = {};
        matchChecked = false;
        openDrawerAmend = null;

        // Update instructions for round context
        const instrEl = document.getElementById('match-round-instructions');
        if (currentMatchRound === 1) {
            instrEl.innerHTML = '<strong style="display:block; margin-bottom:6px;">How it works:</strong><span>Each amendment gets <b>one</b> core right. <b>1.</b> Pick a right from the list below. &nbsp;<b>2.</b> Click the amendment chip it belongs to — the chips will pulse when waiting for your choice. &nbsp;<b>3.</b> Hover over any chip to read what that amendment protects. Click a chip to open its drawer and review (or remove) what you\'ve placed. When you\'ve matched them all, hit <b>Check Answers</b>.</span>';
        } else {
            instrEl.innerHTML = '<strong style="display:block; margin-bottom:6px;">How it works:</strong><span>Now some amendments get <b>multiple</b> rights — look closely! <b>1.</b> Pick a right from the list below. &nbsp;<b>2.</b> Click the amendment chip it belongs to — the chips will pulse when waiting for your choice. &nbsp;<b>3.</b> Hover over any chip to read what that amendment protects. Click a chip to open its drawer and review (or remove) what you\'ve placed. When you\'ve matched them all, hit <b>Check Answers</b>.</span>';
        }

        const itemsList = document.getElementById('match-items-list');
        itemsList.innerHTML = '';
        shuffled.forEach(item => {
            const el = document.createElement('div');
            el.className = 'match-item';
            el.dataset.itemId = item.id;
            el.textContent = item.text;
            el.addEventListener('click', () => selectMatchItem(item.id, el));
            itemsList.appendChild(el);
        });

        const amendList = document.getElementById('match-amendments-list');
        amendList.innerHTML = '';

        // Group: Bill of Rights (1-10) and Extended Rights (13, 14, 19)
        const billOfRights = amendments.filter(a => {
            const num = parseInt(a.id.replace('amend', ''));
            return num <= 10;
        });
        const extendedRights = amendments.filter(a => {
            const num = parseInt(a.id.replace('amend', ''));
            return num > 10;
        });

        const grpLabel1 = document.createElement('div');
        grpLabel1.className = 'amend-group-label';
        grpLabel1.textContent = 'Bill of Rights';
        grpLabel1.style.width = '100%';
        amendList.appendChild(grpLabel1);

        billOfRights.forEach(a => amendList.appendChild(createAmendChip(a)));

        const grpLabel2 = document.createElement('div');
        grpLabel2.className = 'amend-group-label';
        grpLabel2.textContent = 'Extended Rights';
        grpLabel2.style.width = '100%';
        amendList.appendChild(grpLabel2);

        extendedRights.forEach(a => amendList.appendChild(createAmendChip(a)));

        // Close drawer
        document.getElementById('amend-drawer').classList.remove('open');

        updateMatchProgress();
        document.getElementById('match-round-feedback').innerHTML = '';
    }

    function createAmendChip(a) {
        const el = document.createElement('div');
        el.className = 'amend-btn';
        el.dataset.amendId = a.id;
        const shortName = a.name.replace(' Amendment', '');
        el.innerHTML = `<span class="amend-name">${shortName}</span><span class="amend-count" style="display:none;" id="count-${a.id}">0</span><div class="amend-tooltip"><strong>${a.name}</strong><br>${a.description}</div>`;
        el.addEventListener('click', (e) => {
            if (selectedItem) {
                assignToAmendment(a.id);
            } else {
                toggleDrawer(a.id, a.name, a.description);
            }
        });
        return el;
    }

    function toggleDrawer(amendId, name, desc) {
        const drawer = document.getElementById('amend-drawer');
        if (openDrawerAmend === amendId) {
            drawer.classList.remove('open');
            openDrawerAmend = null;
            return;
        }
        openDrawerAmend = amendId;
        document.getElementById('drawer-title').textContent = name;
        document.getElementById('drawer-desc').textContent = desc;
        renderDrawerItems(amendId);
        drawer.classList.add('open');
    }

    function renderDrawerItems(amendId) {
        const container = document.getElementById('drawer-placed');
        container.innerHTML = '';
        const itemsHere = Object.entries(placements).filter(([, aid]) => aid === amendId);
        if (itemsHere.length === 0) {
            container.innerHTML = '<div style="font-size:0.85em;color:#999;font-style:italic;">No rights placed here yet</div>';
            return;
        }
        const items = getMatchItems();
        itemsHere.forEach(([itemId]) => {
            const item = items.find(m => m.id === itemId);
            if (!item) return;
            const tag = document.createElement('div');
            tag.className = 'placed-tag';
            tag.dataset.itemId = itemId;
            if (!matchChecked) {
                tag.innerHTML = `<span>${item.text}</span><span class="remove-x" onclick="event.stopPropagation(); removePlacement('${itemId}');">&times;</span>`;
            } else {
                const isCorrect = item.correctAmendment === amendId;
                tag.classList.add(isCorrect ? 'correct-tag' : 'incorrect-tag');
                tag.innerHTML = `<span>${item.text}</span>`;
            }
            container.appendChild(tag);
        });
    }

    function updateAmendCounts() {
        amendments.forEach(a => {
            const count = Object.values(placements).filter(aid => aid === a.id).length;
            const countEl = document.getElementById('count-' + a.id);
            const btn = document.querySelector(`.amend-btn[data-amend-id="${a.id}"]`);
            if (countEl) {
                if (count > 0) {
                    countEl.style.display = 'inline-block';
                    countEl.textContent = count;
                    btn.classList.add('has-items');
                } else {
                    countEl.style.display = 'none';
                    btn.classList.remove('has-items');
                }
            }
        });
    }

    function selectMatchItem(itemId, el) {
        if (matchChecked) return;
        if (el.classList.contains('placed')) return;

        document.querySelectorAll('.match-item.selected').forEach(s => s.classList.remove('selected'));
        document.querySelectorAll('.amend-btn.waiting').forEach(s => s.classList.remove('waiting'));

        if (selectedItem === itemId) {
            selectedItem = null;
            return;
        }

        selectedItem = itemId;
        el.classList.add('selected');
        document.querySelectorAll('.amend-btn').forEach(b => b.classList.add('waiting'));
    }

    function assignToAmendment(amendId) {
        if (matchChecked) return;
        if (!selectedItem) return;

        const itemId = selectedItem;
        const items = getMatchItems();
        const item = items.find(m => m.id === itemId);
        if (!item) return;

        if (placements[itemId]) {
            removePlacement(itemId);
        }

        placements[itemId] = amendId;

        const itemEl = document.querySelector(`.match-item[data-item-id="${itemId}"]`);
        if (itemEl) {
            itemEl.classList.add('placed');
            itemEl.classList.remove('selected');
        }

        selectedItem = null;
        document.querySelectorAll('.amend-btn.waiting').forEach(s => s.classList.remove('waiting'));
        updateAmendCounts();
        updateMatchProgress();

        const a = amendments.find(am => am.id === amendId);
        if (a) toggleDrawer(amendId, a.name, a.description);
    }

    function removePlacement(itemId) {
        if (matchChecked) return;
        const amendId = placements[itemId];
        if (!amendId) return;

        delete placements[itemId];

        const itemEl = document.querySelector(`.match-item[data-item-id="${itemId}"]`);
        if (itemEl) itemEl.classList.remove('placed');

        updateAmendCounts();
        updateMatchProgress();

        if (openDrawerAmend === amendId) {
            renderDrawerItems(amendId);
        }
    }

    function updateMatchProgress() {
        const items = getMatchItems();
        const placed = Object.keys(placements).length;
        const total = items.length;
        const pct = total > 0 ? Math.round((placed / total) * 100) : 0;
        document.getElementById('match-progress-text').textContent = `${placed} / ${total} placed`;
        document.getElementById('match-progress-bar').style.width = pct + '%';
    }

    function checkMatchRound() {
        matchChecked = true;
        let correct = 0;
        const items = getMatchItems();
        const total = items.length;

        items.forEach(item => {
            const assignedAmend = placements[item.id];
            const itemEl = document.querySelector(`.match-item[data-item-id="${item.id}"]`);

            if (assignedAmend === item.correctAmendment) {
                correct++;
                if (itemEl) { itemEl.classList.add('correct'); itemEl.classList.remove('incorrect'); }
            } else if (assignedAmend) {
                if (itemEl) { itemEl.classList.add('incorrect'); itemEl.classList.remove('correct'); }
            } else {
                if (itemEl) itemEl.classList.add('incorrect');
            }
        });

        if (openDrawerAmend) {
            renderDrawerItems(openDrawerAmend);
        }

        // Color-code the amendment chips
        amendments.forEach(a => {
            const btn = document.querySelector(`.amend-btn[data-amend-id="${a.id}"]`);
            if (!btn) return;
            const itemsHere = Object.entries(placements).filter(([, aid]) => aid === a.id);
            if (itemsHere.length === 0) return;
            const allCorrect = itemsHere.every(([itemId]) => {
                const item = items.find(m => m.id === itemId);
                return item && item.correctAmendment === a.id;
            });
            if (allCorrect) {
                btn.style.borderColor = '#10b981';
                btn.style.background = '#d1fae5';
            } else {
                btn.style.borderColor = '#ef4444';
                btn.style.background = '#fee2e2';
            }
        });

        const placed = Object.keys(placements).length;
        const unplaced = total - placed;
        const pct = Math.round((correct / total) * 100);

        // Save round score
        const scoreKey = currentMatchRound === 1 ? 'scotus-round1-score' : 'scotus-round2-score';
        localStorage.setItem(scoreKey, pct);
        // Update overall sort score with best across rounds
        updateOverallSortScore();

        let fbHtml = `<div class="stats-grid" style="margin-top:20px;">
            <div class="stat-card"><div class="number">${correct}/${total}</div><div class="label">Correct</div></div>
            <div class="stat-card"><div class="number">${pct}%</div><div class="label">Score</div></div>
        </div>`;
        if (unplaced > 0) {
            fbHtml += `<div class="alert info" style="margin-top:15px;"><span>${unplaced} item(s) not yet placed. Place all items and check again for a complete score.</span></div>`;
        }
        if (pct >= 70) {
            if (currentMatchRound === 1) {
                fbHtml += `<div class="alert" style="margin-top:15px; background: #d1fae5; border-left: 4px solid #10b981;"><span>Round 2 unlocked! Click the <b>"Go Deeper"</b> tab — some amendments protect more than one right.</span></div>`;
                unlockRound(2);
            } else {
                fbHtml += `<div class="alert" style="margin-top:15px; background: #d1fae5; border-left: 4px solid #10b981;"><span>Round 3 unlocked! Click the <b>"Apply It"</b> tab to test your knowledge with real Supreme Court cases.</span></div>`;
                unlockRound(3);
            }
        }
        document.getElementById('match-round-feedback').innerHTML = fbHtml;
    }

    function resetMatchRound() {
        initMatchRound(currentMatchRound);
    }

    // ==========================================
    // ROUND 3: APPLY IT — REAL CASES
    // ==========================================
    let round3Answers = {};
    let round3Checked = {};

    function unlockRound(roundNum) {
        const tab = document.getElementById('round' + roundNum + '-tab');
        if (!tab) return;
        tab.classList.remove('locked');
        const subtitle = document.getElementById('round' + roundNum + '-subtitle');
        if (subtitle) {
            subtitle.textContent = roundNum === 2 ? 'Multiple rights per amendment' : 'Match amendments to real cases';
        }
    }

    function showRound(roundNum) {
        // Check if locked
        const tab = document.getElementById('round' + roundNum + '-tab');
        if (tab && tab.classList.contains('locked')) return;

        // Toggle visibility
        const matchDiv = document.getElementById('amend-match-round');
        const round3Div = document.getElementById('amend-round3');
        matchDiv.style.display = (roundNum === 1 || roundNum === 2) ? 'block' : 'none';
        round3Div.style.display = roundNum === 3 ? 'block' : 'none';

        // Toggle active tabs
        document.getElementById('round1-tab').classList.toggle('active', roundNum === 1);
        document.getElementById('round2-tab').classList.toggle('active', roundNum === 2);
        document.getElementById('round3-tab').classList.toggle('active', roundNum === 3);

        // Init the appropriate round
        if (roundNum === 1 || roundNum === 2) {
            initMatchRound(roundNum);
        } else if (roundNum === 3 && document.getElementById('round3-cases').innerHTML === '') {
            initRound3();
        }
    }

    function initRound3() {
        round3Answers = {};
        round3Checked = {};
        const container = document.getElementById('round3-cases');
        container.innerHTML = '';

        round3Cases.forEach((c, i) => {
            const correctAmend = amendments.find(a => a.id === c.correctAmendment);
            let wrongAmends = amendments.filter(a => a.id !== c.correctAmendment);
            wrongAmends = wrongAmends.sort(() => Math.random() - 0.5).slice(0, 3);
            const choices = [...wrongAmends, correctAmend].sort(() => Math.random() - 0.5);

            const studiedBadge = c.studied ? '<span style="background:var(--primary-dark);color:#fff;padding:2px 8px;border-radius:4px;font-size:0.75em;margin-left:8px;vertical-align:middle;">Project Case</span>' : '';

            let html = `<div class="case-challenge" id="case-challenge-${i}">
                <div class="case-label">Case ${i + 1} of ${round3Cases.length}</div>
                <div class="case-name">${c.name}${studiedBadge}</div>
                <div class="case-desc">${c.desc}</div>
                <div class="amend-choices">`;

            choices.forEach(ch => {
                html += `<div class="amend-choice" data-case-idx="${i}" data-amend-id="${ch.id}" onclick="selectRound3Answer(${i}, '${ch.id}', this)">${ch.name}</div>`;
            });

            html += `</div>
                <div class="case-feedback" id="case-fb-${i}"></div>
            </div>`;

            container.innerHTML += html;
        });

        updateRound3Progress();
    }

    function selectRound3Answer(caseIdx, amendId, el) {
        if (round3Checked[caseIdx]) return;
        round3Checked[caseIdx] = true;

        const caseData = round3Cases[caseIdx];
        round3Answers[caseIdx] = amendId;

        el.classList.add('chosen');

        const isCorrect = amendId === caseData.correctAmendment;
        const correctAmend = amendments.find(a => a.id === caseData.correctAmendment);

        const allChoices = document.querySelectorAll(`#case-challenge-${caseIdx} .amend-choice`);
        allChoices.forEach(ch => {
            ch.style.cursor = 'default';
            if (ch.dataset.amendId === caseData.correctAmendment) {
                ch.classList.add('correct-choice');
            } else if (ch === el && !isCorrect) {
                ch.classList.add('incorrect-choice');
            }
        });

        const fb = document.getElementById('case-fb-' + caseIdx);
        fb.className = 'case-feedback show ' + (isCorrect ? 'correct-fb' : 'incorrect-fb');
        fb.innerHTML = `<strong>${isCorrect ? 'Correct!' : 'Not quite — the answer is the ' + correctAmend.name + '.'}</strong><br>${caseData.explanation}<br><a class="oyez-link" href="${caseData.oyez}" target="_blank" rel="noopener">Read more on Oyez &rarr;</a>`;

        updateRound3Progress();
        updateRound3Score();
    }

    function updateRound3Progress() {
        const answered = Object.keys(round3Checked).length;
        const total = round3Cases.length;
        const correct = Object.keys(round3Answers).filter(i => round3Answers[i] === round3Cases[i].correctAmendment).length;
        const pct = total > 0 ? Math.round((answered / total) * 100) : 0;
        document.getElementById('r3-progress-text').textContent = `${correct} / ${total} correct`;
        document.getElementById('r3-progress-bar').style.width = pct + '%';
    }

    function updateRound3Score() {
        const correct = Object.keys(round3Answers).filter(i => round3Answers[i] === round3Cases[i].correctAmendment).length;
        const total = round3Cases.length;
        const answered = Object.keys(round3Checked).length;
        if (answered === total) {
            const pct = Math.round((correct / total) * 100);
            let fbHtml = `<div class="stats-grid" style="margin-top:20px;">
                <div class="stat-card"><div class="number">${correct}/${total}</div><div class="label">Correct</div></div>
                <div class="stat-card"><div class="number">${pct}%</div><div class="label">Score</div></div>
            </div>`;
            document.getElementById('round3-feedback').innerHTML = fbHtml;
            localStorage.setItem('scotus-round3-score', pct);
            updateOverallSortScore();
        }
    }

    function resetRound3() {
        initRound3();
        document.getElementById('round3-feedback').innerHTML = '';
    }

    function updateOverallSortScore() {
        const r1 = parseInt(localStorage.getItem('scotus-round1-score')) || 0;
        const r2 = parseInt(localStorage.getItem('scotus-round2-score')) || 0;
        const r3 = parseInt(localStorage.getItem('scotus-round3-score')) || 0;
        const best = Math.max(r1, r2, r3);
        localStorage.setItem('scotus-sort-score', best);
        document.getElementById('sort-score').textContent = best + '%';
    }

    function initSort() {
        initMatchRound(1);
        // Check if rounds should already be unlocked from previous sessions
        const r1Score = parseInt(localStorage.getItem('scotus-round1-score')) || 0;
        const r2Score = parseInt(localStorage.getItem('scotus-round2-score')) || 0;
        if (r1Score >= 70) unlockRound(2);
        if (r2Score >= 70) unlockRound(3);
    }

    // ==========================================
    // VOCABULARY FLASHCARDS
    // ==========================================
    const vocabTerms = [
        { term: "Jury", definition: "A group of ordinary citizens who listen to evidence and decide guilt or liability." },
        { term: "Judge", definition: "The person who presides over a court and makes decisions about the law and fairness." },
        { term: "Defendant", definition: "The person accused or being sued in a court case." },
        { term: "Plaintiff", definition: "The person bringing a civil lawsuit; the person suing." },
        { term: "Evidence", definition: "Documents, objects, witness testimony, or other information used to prove facts in a case." },
        { term: "Trial Court / District Court", definition: "The first court where a case is heard; evidence and testimony are presented to a judge or jury." },
        { term: "Civil Court", definition: "Handles disputes about money, property, contracts, and other non-criminal matters." },
        { term: "Criminal Court", definition: "Handles cases where someone is accused of breaking a law and could face punishment." },
        { term: "Bench Trial", definition: "A trial where a judge, not a jury, listens to evidence and makes the final decision." },
        { term: "Jury Trial", definition: "A trial where citizens (the jury) listen to evidence and decide if the defendant is guilty or liable." },
        { term: "Appellate Court", definition: "Reviews decisions from lower courts to check if the law was applied correctly." },
        { term: "Court of Appeals", definition: "An appellate court that reviews decisions from trial courts at the federal or state level." },
        { term: "Panel", definition: "A group of judges (usually 2-3) who review a case and vote on the decision." },
        { term: "Affirm", definition: "An appellate court agrees with and upholds the lower court's decision." },
        { term: "Reverse", definition: "An appellate court overturns the lower court's decision, often ordering a new trial." },
        { term: "Federal Court System", definition: "Courts established by the federal government that handle federal laws and constitutional questions." },
        { term: "State Court System", definition: "Courts in each state that handle criminal cases, civil disputes, and state/local laws." },
        { term: "Petitioner", definition: "The person or party who appeals a case to a higher court, asking the court to review the lower court's decision." },
        { term: "Respondent", definition: "The person or party being sued or appealed against; the other side in the case." },
        { term: "Precedent", definition: "A court decision that serves as an example or rule for how similar cases should be decided in the future." },
        { term: "Judicial Review", definition: "The power of courts to decide if laws and government actions are constitutional." },
        { term: "Supreme Court", definition: "The highest U.S. court; decides if laws and government actions are constitutional." },
        { term: "Birthright Citizenship", definition: "The right to become a U.S. citizen by being born in the United States, granted by the 14th Amendment." },
        { term: "Amendment", definition: "An official change or addition to a law, the Constitution, or other legal document." }
    ];

    let currentCard = 0;
    let cardOrder = [];
    let knownCards = new Set();

    function loadVocabProgress() {
        const saved = localStorage.getItem('scotus-vocab-known');
        if (saved) {
            try {
                const arr = JSON.parse(saved);
                knownCards = new Set(arr);
            } catch(e) {
                knownCards = new Set();
            }
        }
    }

    function saveVocabProgress() {
        localStorage.setItem('scotus-vocab-known', JSON.stringify([...knownCards]));
    }

    function initFlashcards() {
        loadVocabProgress();
        cardOrder = vocabTerms.map((_, i) => i);
        currentCard = 0;
        renderCard();
        updateVocabProgress();
    }

    function renderCard() {
        const idx = cardOrder[currentCard];
        const card = vocabTerms[idx];
        const isKnown = knownCards.has(idx);

        const container = document.getElementById('flashcardContainer');
        container.innerHTML = `
            <div class="flashcard${isKnown ? ' known' : ''}" id="flashcard" onclick="flipCard()">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <h3>${card.term}</h3>
                    </div>
                    <div class="flashcard-back">
                        <div class="card-label">Definition</div>
                        <p>${card.definition}</p>
                    </div>
                </div>
            </div>
        `;
    }

    function flipCard() {
        const el = document.getElementById('flashcard');
        if (el) el.classList.toggle('flipped');
    }

    function nextCard() {
        if (currentCard < cardOrder.length - 1) {
            currentCard++;
        } else {
            currentCard = 0;
        }
        renderCard();
    }

    function prevCard() {
        if (currentCard > 0) {
            currentCard--;
        } else {
            currentCard = cardOrder.length - 1;
        }
        renderCard();
    }

    function markKnown() {
        const idx = cardOrder[currentCard];
        if (knownCards.has(idx)) {
            knownCards.delete(idx);
        } else {
            knownCards.add(idx);
        }
        saveVocabProgress();
        renderCard();
        updateVocabProgress();
    }

    function shuffleCards() {
        cardOrder = cardOrder.sort(() => Math.random() - 0.5);
        currentCard = 0;
        renderCard();
    }

    function resetVocabProgress() {
        if (confirm('Reset all vocabulary progress? This will unmark all mastered terms.')) {
            knownCards = new Set();
            saveVocabProgress();
            renderCard();
            updateVocabProgress();
        }
    }

    function updateVocabProgress() {
        const total = vocabTerms.length;
        const known = knownCards.size;
        const pct = Math.round((known / total) * 100);
        document.getElementById('vocabProgressBar').style.width = pct + '%';
        document.getElementById('vocabProgress').textContent = `${known}/${total} terms mastered (${pct}%)`;
        document.getElementById('vocab-score').textContent = `${known}/${total}`;
    }

    // ==========================================
    // SAVE / LOAD PROGRESS
    // ==========================================
    function saveAllProgress() {
        const saData = {};
        saCaseList.forEach(caseName => {
            const key = 'scotus-sa-' + caseName.replace(/[^a-zA-Z0-9]/g, '');
            const saved = localStorage.getItem(key);
            if (saved) saData[key] = JSON.parse(saved);
        });
        const data = {
            version: 2,
            timestamp: new Date().toISOString(),
            vocabKnown: [...knownCards],
            mcScore: localStorage.getItem('scotus-mc-score') || null,
            sortScore: localStorage.getItem('scotus-sort-score') || null,
            saResponses: saData
        };
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'scotus-review-progress.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function loadAllProgress(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);

                // Restore vocab
                if (data.vocabKnown && Array.isArray(data.vocabKnown)) {
                    knownCards = new Set(data.vocabKnown);
                    saveVocabProgress();
                    renderCard();
                    updateVocabProgress();
                }

                // Restore MC score
                if (data.mcScore !== null && data.mcScore !== undefined) {
                    localStorage.setItem('scotus-mc-score', data.mcScore);
                    document.getElementById('mc-score').textContent = data.mcScore + '%';
                }

                // Restore sort score
                if (data.sortScore !== null && data.sortScore !== undefined) {
                    localStorage.setItem('scotus-sort-score', data.sortScore);
                    document.getElementById('sort-score').textContent = data.sortScore + '%';
                }

                // Restore SA responses
                if (data.saResponses) {
                    Object.keys(data.saResponses).forEach(key => {
                        localStorage.setItem(key, JSON.stringify(data.saResponses[key]));
                    });
                    updateSAScore();
                }

                alert('Progress loaded successfully!');
            } catch(err) {
                alert('Error loading progress file. Make sure it is a valid SCOTUS review progress file.');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
    }

    function resetAllProgress() {
        if (confirm('Reset ALL progress? This will clear vocabulary, quiz scores, short answer responses, and sort scores.')) {
            knownCards = new Set();
            saveVocabProgress();
            localStorage.removeItem('scotus-mc-score');
            localStorage.removeItem('scotus-sort-score');
            saCaseList.forEach(caseName => {
                const key = 'scotus-sa-' + caseName.replace(/[^a-zA-Z0-9]/g, '');
                localStorage.removeItem(key);
            });
            document.getElementById('mc-score').textContent = '0%';
            document.getElementById('sa-score').textContent = '0/7';
            document.getElementById('sort-score').textContent = '0%';
            renderCard();
            updateVocabProgress();
        }
    }

    // ==========================================
    // INITIALIZATION
    // ==========================================
    document.addEventListener('DOMContentLoaded', function() {
        initSort();
        initFlashcards();
        initMCCasePicker();
        initSACasePicker();
        updateSAScore();

        // Restore saved scores
        const savedMC = localStorage.getItem('scotus-mc-score');
        const savedSort = localStorage.getItem('scotus-sort-score');
        if (savedMC) document.getElementById('mc-score').textContent = savedMC + '%';
        if (savedSort) document.getElementById('sort-score').textContent = savedSort + '%';

        // Keyboard shortcuts for flashcards
        document.addEventListener('keydown', function(e) {
            const vocabSection = document.getElementById('vocab');
            if (!vocabSection || !vocabSection.classList.contains('active')) return;

            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    prevCard();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    nextCard();
                    break;
                case ' ':
                    e.preventDefault();
                    flipCard();
                    break;
                case 'k':
                case 'K':
                    e.preventDefault();
                    markKnown();
                    break;
                case 'Escape':
                    e.preventDefault();
                    showSection('home');
                    break;
            }
        });
    });
    </script>
</body>
</html>
